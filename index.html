<html>
  <head>
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
  </head>
  <body>
    <script src="https://cdn.socket.io/4.5.0/socket.io.min.js"></script>
    <script>
      var socket = io({ query: { user: "guest" } });

      socket.on("connect", () => {
        document.addEventListener("keydown", function (e) {
          if (e.key === "w") move();
          if (e.key === "a") move();
          if (e.key === "s") move();
          if (e.key === "d") move();
        });
      });

      socket.on("newGuest", function (msg) {
        var el = document.createElement("a-entity");
        var sceneEl = document.querySelector("a-scene");
        var entityEl = document.createElement("a-box");
        entityEl.setAttribute("color", "tomato");
        entityEl.setAttribute("position", `${msg.position} 10 5`);
        entityEl.setAttribute("depth", "1");
        entityEl.setAttribute("height", "4");
        entityEl.setAttribute("width", "0.5");
        entityEl.setAttribute("id", "guest");
        sceneEl.appendChild(entityEl);
        console.log("entity created");
      });

      socket.on("move", function (position) {
        var sceneEl = document.querySelector("a-scene");
        var entityEl = sceneEl.querySelector("#guest");
        console.log("guest", entityEl);
        if (entityEl) {
          entityEl.setAttribute("position", position);
        }
      });

      function move() {
        var sceneEl = document.querySelector("a-scene");
        var entityEl = sceneEl.querySelector("#camera");
        var position = entityEl.getAttribute("position");
        socket.emit("move", position);
      }
    </script>
    <a-scene background="color: #FF5733">
      <a-assets>
        <img id="plane" src="cityplane.png" /><img id="sky" src="sky.png" />
      </a-assets>
      <a-entity id="rig" position="25 10 0">
        <a-camera id="camera"></a-camera>
      </a-entity>
      <a-box position="40 10 0" color="black" depth="2" height="4" width="0.5"></a-box>
      <a-plane
        position="0 0 0"
        rotation="-90 0 0"
        width="400"
        height="400"
        src="#plane"
      ></a-plane>
      <a-sky src="#sky"></a-sky>
    </a-scene>
  </body>
</html>
